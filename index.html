<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lista de Compras</title>
    
    <!-- Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel para traduzir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Ajustes finos para sensação de app nativo */
        body {
            background-color: #f3f4f6;
            touch-action: manipulation;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Efeito de clique nas linhas */
        .item-row:active {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body>

<div id="root">
    <div style="display:flex;justify-content:center;align-items:center;height:100vh;color:#666;font-family:sans-serif;">
        Carregando aplicativo...
    </div>
</div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- ÍCONES (SVG Inline para evitar erros de carregamento externo) ---
    const IconCart = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-12 h-12 mb-2 opacity-50"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
    );

    const IconPlus = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
    );

    const IconTrash = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
    );

    function App() {
        // --- ESTADOS ---
        const [items, setItems] = useState([]);
        const [name, setName] = useState('');
        const [price, setPrice] = useState('');
        const [qty, setQty] = useState('');
        
        // Estado para controlar o modal de exclusão
        const [itemToDelete, setItemToDelete] = useState(null);

        // --- PERSISTÊNCIA (Carregar e Salvar) ---
        
        // Carregar dados ao iniciar
        useEffect(() => {
            const savedItems = localStorage.getItem('myShoppingList');
            if (savedItems) {
                try {
                    setItems(JSON.parse(savedItems));
                } catch (e) {
                    console.error("Erro ao carregar dados", e);
                }
            }
        }, []);

        // Salvar dados sempre que a lista mudar
        useEffect(() => {
            localStorage.setItem('myShoppingList', JSON.stringify(items));
        }, [items]);

        // --- LÓGICA ---

        const handleAddItem = (e) => {
            e.preventDefault();
            
            if (!name || !price || !qty) return;

            const newItem = {
                id: Date.now(), // ID único baseado no tempo
                name: name,
                price: parseFloat(price),
                qty: parseFloat(qty)
            };

            setItems([...items, newItem]);
            
            // Limpar campos e manter foco no nome para digitar o próximo
            setName('');
            setPrice('');
            setQty('');
            document.getElementById('input-name').focus();
        };

        const confirmDelete = () => {
            if (itemToDelete) {
                setItems(items.filter(item => item.id !== itemToDelete.id));
                setItemToDelete(null);
            }
        };

        const cancelDelete = () => {
            setItemToDelete(null);
        };

        // Cálculos de totais
        const totalSum = items.reduce((acc, item) => acc + (item.price * item.qty), 0);

        // --- RENDERIZAÇÃO ---
        return (
            <div className="flex flex-col h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden relative">
                
                {/* Cabeçalho */}
                <header className="bg-blue-600 text-white p-4 shadow-md z-10">
                    <h1 className="text-xl font-bold text-center">Lista de Compras</h1>
                </header>

                {/* Área de Conteúdo (Lista) com rolagem */}
                <div className="flex-1 overflow-y-auto pb-32">
                    {items.length === 0 ? (
                        <div className="flex flex-col items-center justify-center h-64 text-gray-400">
                            <IconCart />
                            <p>Sua lista está vazia.</p>
                        </div>
                    ) : (
                        <table className="w-full text-left border-collapse">
                            <thead className="bg-gray-100 text-gray-600 text-xs uppercase sticky top-0 shadow-sm">
                                <tr>
                                    <th className="p-3 font-semibold">Item</th>
                                    <th className="p-3 font-semibold text-right">R$ Un.</th>
                                    <th className="p-3 font-semibold text-center">Qtd</th>
                                    <th className="p-3 font-semibold text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {items.map((item) => (
                                    <tr 
                                        key={item.id} 
                                        onClick={() => setItemToDelete(item)}
                                        className="border-b border-gray-100 item-row cursor-pointer transition-colors duration-150"
                                    >
                                        <td className="p-3 font-medium text-gray-800">{item.name}</td>
                                        <td className="p-3 text-right text-gray-600 text-sm">
                                            {item.price.toFixed(2)}
                                        </td>
                                        <td className="p-3 text-center text-gray-600 text-sm">
                                            {item.qty}
                                        </td>
                                        <td className="p-3 text-right font-bold text-blue-600">
                                            {(item.price * item.qty).toFixed(2)}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    )}
                </div>

                {/* Formulário de Adição (Fixo na parte inferior acima do total) */}
                <div className="bg-gray-50 border-t border-gray-200 p-3 z-20">
                    <form onSubmit={handleAddItem} className="flex flex-col gap-2">
                        <div className="flex gap-2">
                            <input 
                                id="input-name"
                                type="text" 
                                placeholder="Item (ex: Arroz)" 
                                className="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                autoComplete="off"
                            />
                        </div>
                        <div className="flex gap-2">
                            <div className="relative flex-1">
                                <span className="absolute left-3 top-2 text-gray-400 text-sm">R$</span>
                                <input 
                                    type="number" 
                                    inputMode="decimal" 
                                    step="0.01" 
                                    placeholder="0.00" 
                                    className="w-full p-2 pl-8 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                    value={price}
                                    onChange={(e) => setPrice(e.target.value)}
                                />
                            </div>
                            <input 
                                type="number" 
                                inputMode="decimal" 
                                step="0.001" 
                                placeholder="Qtd" 
                                className="w-20 p-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:border-blue-500"
                                value={qty}
                                onChange={(e) => setQty(e.target.value)}
                            />
                            <button 
                                type="submit" 
                                className="bg-blue-600 text-white p-2 rounded-lg font-bold w-12 flex items-center justify-center active:bg-blue-800 transition-colors"
                            >
                                <IconPlus />
                            </button>
                        </div>
                    </form>
                </div>

                {/* Total Geral (Rodapé fixo) */}
                <div className="bg-gray-900 text-white p-4 flex justify-between items-center z-30 shadow-lg">
                    <span className="text-gray-400 font-medium">Total Geral</span>
                    <span className="text-2xl font-bold text-green-400">
                        R$ {totalSum.toFixed(2)}
                    </span>
                </div>

                {/* Modal de Confirmação de Exclusão */}
                {itemToDelete && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in">
                        <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
                            <h3 className="text-lg font-bold text-gray-800 mb-2">Remover Item?</h3>
                            <p className="text-gray-600 mb-6">
                                Deseja remover <strong>{itemToDelete.name}</strong> da lista?
                            </p>
                            <div className="flex gap-3 justify-end">
                                <button 
                                    onClick={cancelDelete}
                                    className="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300"
                                >
                                    Cancelar
                                </button>
                                <button 
                                    onClick={confirmDelete}
                                    className="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 flex items-center gap-2"
                                >
                                    <IconTrash />
                                    Remover
                                </button>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        );
    }

    // Inicializar App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>